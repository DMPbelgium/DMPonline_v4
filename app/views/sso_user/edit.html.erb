<h1>Complete user information</h1>

<div class="white_background">

  <%= form_tag( :controller => :sso_user, :action => "update", :method => :post ) do %>

    <div class="dmp_details">

      <table class="dmp_details_table">
        <tr>
          <td class="first"><%= (t('helpers.email') + ' *') %></td>
          <td><%= email_field_tag 'user[email]', @sso_user["email"] %></td>
        </tr>
        <tr>
          <td class="first"><%= t('helpers.first_name') + ' *' %></td>
          <td>
            <%= text_field_tag 'user[firstname]', @sso_user["firstname"],
              :id => "first_time_login_firstname",
              :autofocus => true,
              :class => 'text_field has-tooltip',
              'data-toggle' => "tooltip",
              'data-trigger' => "focus" ,
              'title' => t('helpers.first_name_help_text')
            %>
          </td>
        </tr>
        <tr>
          <td class="first"><%= t('helpers.last_name') + ' *' %></td>
          <td>
            <%= text_field_tag 'user[surname]', @sso_user["surname"],
              :as => :string, :id => "first_time_login_surname",
              :class => 'text_field has-tooltip',
              'data-toggle' => "tooltip",
              'data-trigger' => "focus" ,
              'title' => t('helpers.surname_help_text')
            %>
          </td>
        </tr>
        <tr>
          <td class="first"><%= t('helpers.org_type.organisation') + ' *' %></td>
          <td>
              <%= select_tag 'user[organisation_id]', options_for_select(
                [[ t('helpers.org_type.organisation'), nil ]] +
                Organisation.where("parent_id IS NULL").order("name").collect { |org| [ org.name, org.id ] }
              ), :class => 'typeahead org_sign_up'
              %>

              <div id="other-org-link"><a href="#"><%= t("helpers.org_not_listed") %></a></div>
          </td>
        </tr>

        <% other_organisations = Array.new %>
        <% Organisation.where("parent_id IS ? AND is_other = ?", nil, 1).each do |org| %>
          <% other_organisations << org.id %>
        <% end %>

        <tr id="other-organisation-name" style="display:none" data-orgs="<%= other_organisations.join(',') %>">
          <td class="first"><%= t('helpers.org_type.org_name')%></td>
          <td><%= text_field_tag 'user[other_organisation]','',
              placeholder: (t('helpers.org_type.org_name') + ' *'),
              :class => 'text_field has-tooltip reg-input', 'data-toggle' => "tooltip", 'data-container' => "body", 'title' => t('helpers.org_type.other_org_help_text') %></td>
        </tr>
        <tr>
          <td class="first"></td>
          <td>
            <%= submit_tag t('helpers.sign_up'), :class => "btn btn-primary" %>
          </td>
        </tr>

      </table>

    </div>

  <% end %>

</div>
